---
title: "Characterization of oscillator (CTS 970), first board built for Einar"
author: "Erik Ø. Sørensen"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
```

# Current drawn

From an ambient temperature, I measured how much current the oscillator
drew from the power supply in the first minutes (at 5V). I measured
the current draw every 10th second.

```{r include=FALSE}
is <- c(0.620, 0.623, 0.623, 0.623, 0.623, 0.620, 
        0.622, 0.622, 0.621, 0.413, 0.364, 0.344,
        0.333, 0.323, 0.316, 0.310, 0.303, 0.298,
        0.293, 0.291, 0.285, 0.290, 0.292, 0.292,
        0.292, 0.290) * 1000
start <- as_datetime("2023-12-20T204800")
second <- as_datetime("2023-12-20T204810")                
ts <- seq(start, by=difftime(second,start),length.out=26)
df <- tibble(current=is, time=ts)
```

```{r}
df |> ggplot(aes(x=time, y=current)) +
  geom_line() +
  theme_minimal() +
  labs(x = "Measurement moment", y = "Current draw [mA]",
       title="The oscillator warming up") +
  theme(plot.title.position = "plot")
```

Very slowly, the current draw continued to drop, at 22:20 the current drwan was 236 mA.

# Frequency vs control voltage

If the frequency generated cannot be controlled in a proper window around 10MHz,
the oscillator might be too old and for use. I measured the frequency
generated for some control voltages, and this doesn't seem like a problem.

```{r include=FALSE}
df2 <- tibble(V_control = c(2.000, 2.100, 2.200, 2.300, 2.400),
              f_out = c(9999999.1, 9999999.490, 9999999.965, 10000000.246, 10000000.621))
df2 |> ggplot(aes(x=V_control, y=f_out)) +
  geom_line() +
  geom_point() + 
  theme_minimal() +
  scale_y_continuous(labels = scales::label_comma()) +
  labs(x="Control voltage [V]", y = "Frequency [Hz]", 
       title="Frequency vs control voltage") +
  theme(plot.title.position = "plot")
dlta <- (max(df2$f_out) - min(df2$f_out))/(max(df2$V_control)-min(df2$V_control))
```

The frequency was measure by my Agilent 53131A with a GPSDO reference,
with a 1s gate time. This seems fairly linear, with about
`r dlta`
Hz/V. The potentiometer on the board has 4.096 V over 23 turns, so this will
give about `r dlta * 4.096 /23` Hz/turn which should make it possible to 
calibrate it fairly precisely.

